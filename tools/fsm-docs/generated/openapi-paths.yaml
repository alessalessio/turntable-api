openapi: 3.0.3
info:
  title: Turntable API
  description: RESTful HATEOAS API for a vinyl turntable with FSM-driven state transitions.
  version: 1.0.0
  license:
    name: MIT
servers:
  - url: 'http://localhost:3000'
    description: Local development server
tags:
  - name: Turntable
    description: Turntable state and actions
  - name: Health
    description: Health check endpoints
paths:
  /turntable:
    get:
      operationId: getState
      summary: Get turntable state
      description: Returns the current turntable state with HATEOAS links for available actions.
      tags:
        - Turntable
      responses:
        200:
          description: Current turntable state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
  /health:
    get:
      operationId: healthCheck
      summary: Health check
      description: Returns the health status of the API.
      tags:
        - Health
      responses:
        200:
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
  /turntable/power/on:
    post:
      operationId: powerOn
      summary: Power on the turntable
      description: Powers on the turntable. Only allowed when turntable is OFF.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /turntable/power/off:
    post:
      operationId: powerOff
      summary: Power off the turntable
      description: Powers off the turntable. Only allowed when turntable is ON and playback is STOPPED.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /turntable/vinyl:
    put:
      operationId: putVinyl
      summary: Put a vinyl on the turntable / Change the vinyl on the turntable
      description: |-
          **put-vinyl**: Loads a random vinyl from the catalog. Only allowed when ON, STOPPED, and no vinyl loaded.
          
          **change-vinyl**: Replaces the current vinyl with a random one. Only allowed when ON, STOPPED, and vinyl is loaded.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: removeVinyl
      summary: Remove the vinyl from the turntable
      description: Removes the current vinyl. Only allowed when ON, STOPPED, and vinyl is loaded.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /turntable/play:
    post:
      operationId: play
      summary: Start playback
      description: Starts playing the loaded vinyl. Only allowed when ON, vinyl LOADED, and STOPPED.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /turntable/stop:
    post:
      operationId: stop
      summary: Stop playback
      description: Stops the current playback. Only allowed when PLAYING.
      tags:
        - Turntable
      responses:
        200:
          description: Successful state transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TurntableResource'
        409:
          description: Invalid state transition - action not allowed in current state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    TurntableResource:
      type: object
      properties:
        powerState:
          type: string
          enum:
            - OFF
            - ON
          description: Current power state of the turntable
        vinylState:
          type: string
          enum:
            - EMPTY
            - LOADED
          description: Whether a vinyl is loaded
        playbackState:
          type: string
          enum:
            - STOPPED
            - PLAYING
          description: Current playback state
        currentVinyl:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/Vinyl'

          description: Currently loaded vinyl, or null if none
        _links:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/HateoasLink'
          description: HATEOAS links for available actions
      required:
        - powerState
        - vinylState
        - playbackState
        - _links
    Vinyl:
      type: object
      properties:
        id:
          type: string
          description: Unique vinyl identifier
        title:
          type: string
          description: Track title
        composer:
          type: string
          description: Composer name
        midiUrl:
          type: string
          description: URL to MIDI file
      required:
        - id
        - title
        - composer
        - midiUrl
    HateoasLink:
      type: object
      properties:
        href:
          type: string
          description: URL for the action
        method:
          type: string
          description: HTTP method to use
      required:
        - href
        - method
    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
            message:
              type: string
              description: Human-readable error message
          required:
            - code
            - message
      required:
        - error